<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maxi • Ride Anytime, Anywhere</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  
  <!-- Leaflet CSS + JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Google Maps API (replace YOUR_API_KEY with real key; enable Places + Directions APIs) -->
  <script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCK_Rty8ZD3wQf53UmEj_TvBTIm4STPq1s",
      authDomain: "maxiapp-ecebd.firebaseapp.com",
      projectId: "maxiapp-ecebd",
      storageBucket: "maxiapp-ecebd.firebasestorage.app",
      messagingSenderId: "905818003389",
      appId: "1:905818003389:web:c0482385ff4bf4b4b964d4",
      measurementId: "G-NK04VED033"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    window.firebaseApp = app;
  </script>

  <style>
    :root {
      --bg: #ffffff;
      --card-bg: rgba(255, 255, 255, 0.75);
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --border: #e2e8f0;
      --accent: #10b981;
      --accent-secondary: #8b5cf6;
      --gradient: linear-gradient(135deg, #10b981 0%, #3b82f6 50%, #8b5cf6 100%);
    }

    body.dark {
      --bg: #0f172a;
      --card-bg: rgba(15, 23, 42, 0.6);
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --border: rgba(148, 163, 184, 0.2);
      --card-bg: rgba(30, 41, 59, 0.5);
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      transition: background-color 0.4s, color 0.4s;
    }

    .glass {
      background: var(--card-bg);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--border);
    }

    .gradient-text {
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    #map { height: 70vh; min-height: 500px; z-index: 1; }
    .leaflet-container { font-size: 14px; }

    @keyframes pulse {
      0% { transform: scale(0.95); opacity: 1; }
      70% { transform: scale(1.4); opacity: 0.4; }
      100% { transform: scale(0.95); opacity: 0; }
    }

    .pulse-ring {
      position: absolute;
      inset: 0;
      margin: auto;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(59, 130, 246, 0.5);
      animation: pulse 2.5s infinite;
      pointer-events: none;
    }

    .driver-dot {
      width: 14px;
      height: 14px;
      background: #ef4444;
      border: 3px solid white;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.7);
      animation: pulseDriver 3s infinite;
    }

    @keyframes pulseDriver {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }

    .driver-photo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #10b981;
    }

    .bottom-nav { transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .nav-item { transition: all 0.3s ease; }
    .nav-item.active { transform: translateY(-8px) scale(1.15); }
    .nav-item.active .icon-bg { background: var(--gradient); box-shadow: 0 10px 25px -10px rgba(16, 185, 129, 0.4); }
    .nav-item .label { opacity: 0; transform: translateY(8px); transition: all 0.3s ease; }
    .nav-item.active .label { opacity: 1; transform: translateY(0); }

    .pac-container { z-index: 9999 !important; }
  </style>
</head>
<body class="antialiased pb-24 md:pb-0">

  <!-- Header -->
  <header class="fixed top-0 left-0 right-0 z-50 glass transition-all duration-300">
    <nav class="max-w-7xl mx-auto px-6 lg:px-8 py-4 flex items-center justify-between">
      <div class="text-3xl font-extrabold gradient-text tracking-tight">Maxi</div>
      <div class="hidden md:flex items-center space-x-10 text-sm font-medium">
        <a href="#ride" class="hover:text-[var(--accent)] transition-colors">Ride</a>
        <a href="#drive" class="hover:text-[var(--accent)] transition-colors">Drive</a>
        <a href="#features" class="hover:text-[var(--accent)] transition-colors">Features</a>
        <a href="#cities" class="hover:text-[var(--accent)] transition-colors">Cities</a>
      </div>
      <div class="flex items-center gap-4">
        <button id="dark-toggle" title="Toggle dark mode" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">
          <span class="material-icons">dark_mode</span>
        </button>
        <a href="#" class="px-6 py-2.5 rounded-full bg-black text-white font-semibold hover:shadow-lg hover:shadow-black/30 transition-all transform hover:scale-105">
          Open App
        </a>
      </div>
    </nav>
  </header>

  <!-- Hero + Ride Form -->
  <section class="relative z-20 pt-28 pb-6 md:pt-40 md:pb-0 px-6 lg:px-8">
    <div class="max-w-5xl mx-auto text-center">
      <h1 class="text-5xl md:text-7xl font-extrabold tracking-tight leading-tight mb-4">
        Go anywhere with <span class="gradient-text">Maxi</span>
      </h1>
      <p class="text-xl md:text-2xl text-[var(--text-secondary)] max-w-3xl mx-auto mb-8">
        Request a ride in minutes — 24/7 across Durban and beyond
      </p>
    </div>

    <div class="max-w-lg mx-auto relative z-30 -mb-32 md:-mb-40">
      <div class="glass rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-emerald-600 to-blue-600 p-6 text-white">
          <h2 class="text-2xl font-bold">Where to?</h2>
        </div>
        <div class="p-6 space-y-5 ride-form">
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"><span class="material-icons">location_on</span></div>
            <input id="pickup-input" type="text" placeholder="Current location or enter pickup" class="w-full pl-12 pr-4 py-4 bg-white/80 dark:bg-slate-800/80 rounded-xl border border-gray-300 dark:border-slate-600 text-lg focus:border-[var(--accent)]" />
          </div>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"><span class="material-icons">flag</span></div>
            <input id="dropoff-input" type="text" placeholder="Enter destination" class="w-full pl-12 pr-4 py-4 bg-white/80 dark:bg-slate-800/80 rounded-xl border border-gray-300 dark:border-slate-600 text-lg focus:border-[var(--accent)]" />
          </div>
          <div class="grid grid-cols-3 gap-3 pt-2">
            <button class="py-3 rounded-xl border-2 border-[var(--accent)] bg-[var(--accent)]/10 text-[var(--accent)] font-medium hover:bg-[var(--accent)] hover:text-white transition active">Economy</button>
            <button class="py-3 rounded-xl border border-gray-300 dark:border-slate-600 hover:border-[var(--accent)] hover:text-[var(--accent)] transition">Comfort</button>
            <button class="py-3 rounded-xl border border-gray-300 dark:border-slate-600 hover:border-[var(--accent)] hover:text-[var(--accent)] transition">MaxiXL</button>
          </div>
          <div id="eta-price-overlay" class="text-center text-sm text-[var(--text-secondary)] py-2 hidden">
            Estimated: <span id="eta">4 min</span> • R<span id="price">45-60</span>
          </div>
          <button class="w-full py-5 mt-2 rounded-xl bg-gradient-to-r from-emerald-500 to-blue-600 text-white font-bold text-xl shadow-lg hover:shadow-2xl hover:shadow-emerald-500/40 transform hover:scale-[1.02] transition-all">
            Request Maxi
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Map -->
  <section class="relative z-10 h-[70vh] md:h-[90vh] -mt-32 md:-mt-64">
    <div id="map"></div>
  </section>

  <!-- Features -->
  <section id="features" class="py-20 px-6 lg:px-8 bg-gradient-to-b from-transparent via-slate-50/40 to-transparent dark:via-slate-900/30 relative z-20">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-bold mb-4">Why ride with Maxi?</h2>
        <p class="text-xl text-[var(--text-secondary)] max-w-3xl mx-auto">Safe • Fast • Affordable</p>
      </div>
      <div class="grid md:grid-cols-3 gap-8">
        <div class="glass rounded-3xl p-8 hover:shadow-2xl transition-all hover:-translate-y-2">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-400 flex items-center justify-center text-white mb-6"><span class="material-icons text-3xl">speed</span></div>
          <h3 class="text-2xl font-bold mb-3">Arrives Fast</h3>
          <p class="text-[var(--text-secondary)]">Usually under 5 minutes in Durban</p>
        </div>
        <div class="glass rounded-3xl p-8 hover:shadow-2xl transition-all hover:-translate-y-2">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center text-white mb-6"><span class="material-icons text-3xl">shield</span></div>
          <h3 class="text-2xl font-bold mb-3">Safety First</h3>
          <p class="text-[var(--text-secondary)]">Share trip • Verified drivers • 24/7 support</p>
        </div>
        <div class="glass rounded-3xl p-8 hover:shadow-2xl transition-all hover:-translate-y-2">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center text-white mb-6"><span class="material-icons text-3xl">payments</span></div>
          <h3 class="text-2xl font-bold mb-3">Flexible Payment</h3>
          <p class="text-[var(--text-secondary)]">Card • Cash • Instant EFT • SnapScan</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Mobile Bottom Nav -->
  <nav class="fixed bottom-0 left-0 right-0 z-50 md:hidden">
    <div class="glass mx-4 mb-6 rounded-2xl shadow-2xl border border-[var(--border)] overflow-hidden">
      <div class="flex items-center justify-around py-3 px-6 bottom-nav">
        <button class="nav-item flex flex-col items-center active" onclick="setActive(this)">
          <div class="icon-bg w-10 h-10 rounded-full flex items-center justify-center mb-1"><span class="material-icons text-2xl">home</span></div>
          <span class="label text-xs font-medium">Home</span>
        </button>
        <button class="nav-item flex flex-col items-center" onclick="setActive(this)">
          <div class="icon-bg w-10 h-10 rounded-full flex items-center justify-center mb-1"><span class="material-icons text-2xl">history</span></div>
          <span class="label text-xs font-medium">Activity</span>
        </button>
        <button class="nav-item flex flex-col items-center" onclick="setActive(this)">
          <div class="icon-bg w-10 h-10 rounded-full flex items-center justify-center mb-1"><span class="material-icons text-2xl">person</span></div>
          <span class="label text-xs font-medium">Account</span>
        </button>
      </div>
    </div>
  </nav>

  <script>
    // Dark mode
    const darkToggle = document.getElementById('dark-toggle');
    const html = document.documentElement;
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      html.classList.add('dark');
    }
    darkToggle.addEventListener('click', () => {
      html.classList.toggle('dark');
      localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
      updateMapStyle();
    });

    // Bottom nav
    function setActive(el) {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      el.classList.add('active');
      el.querySelector('.icon-bg').style.background = 'var(--gradient)';
    }

    // Map & features
    let map, pickupMarker, routeLine, driverMarkers = [];
    let pickupLatLng, dropoffLatLng;
    let directionsService = new google.maps.DirectionsService();

    const mockDrivers = [
      { name: 'John D.', rating: 4.8, photo: 'https://randomuser.me/api/portraits/men/1.jpg', eta: 3 },
      { name: 'Sarah K.', rating: 4.9, photo: 'https://randomuser.me/api/portraits/women/2.jpg', eta: 4 },
      { name: 'Mike T.', rating: 4.7, photo: 'https://randomuser.me/api/portraits/men/3.jpg', eta: 2 },
      { name: 'Emma L.', rating: 4.9, photo: 'https://randomuser.me/api/portraits/women/4.jpg', eta: 5 },
      { name: 'David R.', rating: 4.6, photo: 'https://randomuser.me/api/portraits/men/5.jpg', eta: 3 },
      { name: 'Anna S.', rating: 4.8, photo: 'https://randomuser.me/api/portraits/women/6.jpg', eta: 4 },
      { name: 'Chris P.', rating: 4.7, photo: 'https://randomuser.me/api/portraits/men/7.jpg', eta: 2 },
      { name: 'Laura M.', rating: 5.0, photo: 'https://randomuser.me/api/portraits/women/8.jpg', eta: 5 }
    ];

    function addMockDrivers(center) {
      driverMarkers.forEach(m => map.removeLayer(m));
      driverMarkers = [];

      for (let i = 0; i < 8; i++) {
        const angle = Math.random() * Math.PI * 2;
        const dist = Math.random() * 0.05 + 0.01;
        const lat = center[0] + Math.cos(angle) * dist;
        const lng = center[1] + Math.sin(angle) * dist;

        const driver = mockDrivers[i];

        const dot = L.divIcon({
          className: '',
          html: '<div class="driver-dot"></div>',
          iconSize: [14, 14],
          iconAnchor: [7, 7]
        });

        const marker = L.marker([lat, lng], { icon: dot }).addTo(map);
        marker.bindPopup(`
          <div class="flex items-center gap-3">
            <img src="${driver.photo}" class="driver-photo" alt="${driver.name}">
            <div>
              <b>${driver.name}</b><br>
              Rating: ${driver.rating} ★<br>
              ETA: ${driver.eta} min
            </div>
          </div>
        `);

        driverMarkers.push(marker);

        // Better movement animation: smooth linear movement
        animateDriver(marker, center);
      }
    }

    function animateDriver(marker, center) {
      const startLatLng = marker.getLatLng();
      const targetAngle = Math.random() * Math.PI * 2;
      const targetDist = Math.random() * 0.03 + 0.005;
      const targetLat = center[0] + Math.cos(targetAngle) * targetDist;
      const targetLng = center[1] + Math.sin(targetAngle) * targetDist;
      const steps = 60; // smoother animation
      let step = 0;

      const interval = setInterval(() => {
        step++;
        const lat = startLatLng.lat + (targetLat - startLatLng.lat) * (step / steps);
        const lng = startLatLng.lng + (targetLng - startLatLng.lng) * (step / steps);
        marker.setLatLng([lat, lng]);

        if (step >= steps) {
          clearInterval(interval);
          animateDriver(marker, center); // Loop animation
        }
      }, 100); // Slower for realistic movement
    }

    function initMap() {
      if (map) map.remove();

      map = L.map('map', {
        zoomControl: false,
        attributionControl: false
      }).setView([-29.8587, 31.0218], 14);

      const isDark = html.classList.contains('dark');
      const tileUrl = isDark 
        ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
        : 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';

      L.tileLayer(tileUrl, { maxZoom: 19 }).addTo(map);

      // Pickup marker
      pickupMarker = L.marker([-29.8587, 31.0218], {
        icon: L.divIcon({
          className: 'relative',
          html: '<div class="w-10 h-10 bg-emerald-500 rounded-full border-4 border-white shadow-lg flex items-center justify-center"><span class="material-icons text-white text-2xl">my_location</span></div><div class="pulse-ring"></div>',
          iconSize: [40, 40],
          iconAnchor: [20, 20]
        })
      }).addTo(map);

      addMockDrivers([-29.8587, 31.0218]);
    }

    function updateMapStyle() {
      initMap();
    }

    // Google Places Autocomplete & Directions
    function initAutocomplete() {
      const pickupInput = document.getElementById('pickup-input');
      const dropoffInput = document.getElementById('dropoff-input');

      const options = {
        componentRestrictions: { country: 'za' },
        types: ['geocode']
      };

      const pickupAutocomplete = new google.maps.places.Autocomplete(pickupInput, options);
      const dropoffAutocomplete = new google.maps.places.Autocomplete(dropoffInput, options);

      pickupAutocomplete.addListener('place_changed', updateRoute);
      dropoffAutocomplete.addListener('place_changed', updateRoute);
    }

    function updateRoute() {
      const pickupPlace = document.getElementById('pickup-input').value;
      const dropoffPlace = document.getElementById('dropoff-input').value;

      if (pickupPlace && dropoffPlace) {
        directionsService.route({
          origin: pickupPlace,
          destination: dropoffPlace,
          travelMode: 'DRIVING'
        }, (response, status) => {
          if (status === 'OK') {
            const route = response.routes[0];
            const path = route.legs[0].steps.reduce((acc, step) => acc.concat(step.path), []);

            // Update polyline on Leaflet
            if (routeLine) map.removeLayer(routeLine);
            routeLine = L.polyline(path.map(p => [p.lat(), p.lng()]), {
              color: '#10b981',
              weight: 6,
              opacity: 0.85
            }).addTo(map);

            // Center map
            map.fitBounds(route.bounds);

            // Update pickup marker
            pickupLatLng = route.legs[0].start_location;
            pickupMarker.setLatLng([pickupLatLng.lat(), pickupLatLng.lng()]);

            dropoffLatLng = route.legs[0].end_location;

            // Refresh drivers around new pickup
            addMockDrivers([pickupLatLng.lat(), pickupLatLng.lng()]);

            // Calculate ETA & Fare
            const duration = route.legs[0].duration.value / 60; // minutes
            const distance = route.legs[0].distance.value / 1000; // km

            // Simple fare logic: base R20 + R10/km + R1/min, range +/-10%
            const baseFare = 20;
            const perKm = 10;
            const perMin = 1;
            const fare = baseFare + (perKm * distance) + (perMin * duration);
            const minFare = Math.floor(fare * 0.9);
            const maxFare = Math.ceil(fare * 1.1);

            document.getElementById('eta').textContent = `${Math.ceil(duration)} min`;
            document.getElementById('price').textContent = `${minFare}-${maxFare}`;
            document.getElementById('eta-price-overlay').classList.remove('hidden');
          } else {
            console.error('Directions request failed:', status);
          }
        });
      }
    }

    // Init
    window.onload = () => {
      initMap();
      if (typeof google !== 'undefined' && google.maps && google.maps.places) {
        initAutocomplete();
      } else {
        console.warn('Google Maps API not loaded - add your API key');
      }
    };

    // Dark mode observer
    const observer = new MutationObserver(updateMapStyle);
    observer.observe(html, { attributes: true, attributeFilter: ['class'] });
  </script>
</body>
</html>
